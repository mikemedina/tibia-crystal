{% extends 'base.html' %}

{% block title %}Spell Data{% endblock %}

{% block content %}
    <div class="table-container">
        <label for="targets">Targets:</label>
        <input type="number" id="targets" name="targets" value="1" min="1" max="10" oninput="updateTable()">
        <br>
        <br>
        <table id="spell-table">
            <thead>
                <tr>
                    <th onclick="sortTable(0)">Spell Name</th>
                    <th onclick="sortTable(1)">Damage</th>
                </tr>
            </thead>
            <tbody>
                {% for spell_name, damage in spell_data.items() %}
                    <tr>
                        <td>{{ spell_name }}</td>
                        <td id="damage-{{ loop.index }}" data-original="{{ damage }}">{{ damage }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        function updateTable() {
            const targets = parseFloat(document.getElementById("targets").value);
            const rows = document.querySelectorAll("#spell-table tbody tr");

            rows.forEach((row, index) => {
                const damage = document.getElementById(`damage-${index + 1}`);
                const originalDamage = parseFloat(damage.dataset.original);
                damage.textContent = originalDamage * targets;
            });
        }

        function sortTable(columnIndex) {
            const table = document.getElementById("spell-table");
            const rows = Array.from(table.rows);

            rows.sort((a, b) => {
                const valueA = a.cells[columnIndex].textContent;
                const valueB = b.cells[columnIndex].textContent;

                return valueA.localeCompare(valueB, undefined, { numeric: true, sensitivity: 'base' });
            });

            if (table.rows[1] === rows[0]) {
                rows.reverse();
            }

            for (let i = 0; i < rows.length; i++) {
                table.tBodies[0].appendChild(rows[i]);
            }
        }
    </script>
{% endblock %}
